def fuse_risk(result):

    if result.get("error"):
        return {
            "verdict": "ERROR",
            "score": 0,
            "reasons": ["File could not be processed"]
        }

    file_type = result["type"]
    total_score = 0
    escalation_bonus = 0
    reasons = []

    # ================= SCRIPT =================
    if file_type == "script":

        execution = result["execution"]
        network = result["network"]
        obfuscation = result["obfuscation"]
        persistence = result["persistence"]

        total_score = execution + network + obfuscation + persistence

        # Strong correlation rules
        if execution > 0 and network > 0:
            escalation_bonus += 30
            reasons.append("Execution + Network behavior")

        if obfuscation > 30 and execution > 0:
            escalation_bonus += 20
            reasons.append("Obfuscated execution")

        if persistence > 0 and execution > 0:
            escalation_bonus += 20
            reasons.append("Persistence + Execution")

        total_score += escalation_bonus
        reasons.extend(result["signals"])

    # ================= PDF =================
    elif file_type == "pdf":

        total_score = result["structure_score"]

        if total_score >= 40:
            reasons.append("Malicious PDF structure indicators")

        reasons.extend(result["signals"])

    # ================= PE (ML BASED) =================
    elif file_type == "pe":

        total_score = result["ml_score"]

        # Strong ML confidence threshold
        if total_score >= 70:
            reasons.append("ML model indicates high malware probability")

        reasons.extend(result.get("signals", []))

    # ================= UNKNOWN =================
    elif file_type == "unknown":

        total_score = result["anomaly_score"]

        if total_score >= 30:
            reasons.append("High entropy or anomaly pattern detected")

        reasons.extend(result["signals"])

    # ================= DEFAULT =================
    else:
        total_score = 0

    # ================= FINAL VERDICT =================

    if total_score >= 120:
        verdict = "MALWARE"
    elif total_score >= 50:
        verdict = "SUSPICIOUS"
    else:
        verdict = "SAFE"

    return {
        "verdict": verdict,
        "score": total_score,
        "reasons": reasons
    }
